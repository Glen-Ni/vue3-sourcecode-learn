{"version":3,"file":"reactivity.global.js","sources":["../../shared/src/index.ts","../src/baseHandler.ts","../src/reactive.ts"],"sourcesContent":["const isObject = (target: any) => {\r\n  return typeof target === 'object' && target !== null;\r\n}\r\n\r\nexport {isObject};\r\n","import {isObject} from \"@vue/shared\";\r\nimport {reactive, readonly} from \"./reactive\";\r\n\r\nfunction createGetter(isReadonly = false, shallow = false,) {\r\n  /**\r\n   * target 原来对象\r\n   * key 取啥属性\r\n   * recevier 代理对象\r\n   */\r\n  return function get(target, key, receiver) {\r\n    // if( isObject(target[key]) && !shallow) {\r\n    //   return reactive(target[key]);\r\n    // }\r\n    console.log('【读取了】', key)\r\n    const res = Reflect.get(target, key, receiver)\r\n    if(!isReadonly) {\r\n      console.log('读取，收集依赖更新视图', key);\r\n    }\r\n    if (shallow) {\r\n      return res;\r\n    }\r\n    if (isObject(res)) {\r\n      return isReadonly ? readonly(res) : reactive(res);\r\n    }\r\n    return res;\r\n  }\r\n}\r\n\r\nfunction createSetter(isShallow = false) {\r\n  return function set(target, key, value, receiver) {\r\n    const res = Reflect.set(target, key, value, receiver)\r\n    console.log(`【设置了】${key}的set调用了, 等待视图更新`)\r\n    return res\r\n  }\r\n}\r\n\r\nconst get = createGetter();\r\nconst shallowGet = createGetter(false, true)\r\nconst readonlyGet = createGetter(true)\r\nconst shallowReadonlyGet = createGetter(true, true)\r\n\r\nconst set = createSetter();\r\nconst shallowSet = createSetter(true)\r\n\r\nconst readonlySet = {\r\n  set: function (target, key) {\r\n    console.warn(`cannot set ${key} on a readonly target ${JSON.stringify(target)}`)\r\n  }\r\n} // 我也不知道为啥要写成对象，然后用Object.assign合并\r\n\r\nexport const mutableHandlers = {\r\n  get,\r\n  set\r\n}\r\nexport const shallowReactiveHandlers = {\r\n  get: shallowGet,\r\n  set: shallowSet\r\n}\r\n\r\nexport const readonlyHandlers = Object.assign({\r\n  get: readonlyGet,\r\n}, readonlySet)\r\nexport const shallowReadonlyHandlers = Object.assign({\r\n  get: shallowReadonlyGet\r\n}, readonlySet)","// import {isObject} from \"../../shared/src/index\";\r\n// 改为\r\nimport {isObject} from \"@vue/shared\";\r\nimport {mutableHandlers, readonlyHandlers, shallowReactiveHandlers, shallowReadonlyHandlers} from \"./baseHandler\";\r\n\r\n\r\nexport function reactive(target) {\r\n  return createReactiveObject(target, false, mutableHandlers)\r\n}\r\n\r\nexport function shallowReactive(target) {\r\n  return createReactiveObject(target, false, shallowReactiveHandlers)\r\n}\r\n\r\nexport function readonly(target) {\r\n  return createReactiveObject(target, false, readonlyHandlers)\r\n}\r\n\r\nexport function shallowReadonly(target) {\r\n  return createReactiveObject(target, false, shallowReadonlyHandlers)\r\n}\r\n\r\n/**\r\n *\r\n * @param target\r\n * @param isReadonly\r\n * @param baseHandler\r\n */\r\nconst reactiveMap = new WeakMap();\r\nconst readonlyMap = new WeakMap();\r\n\r\nfunction createReactiveObject(target, isReadonly, baseHandler) {\r\n  if (!isObject(target)) {\r\n    return target\r\n  }\r\n  const proxyMap = isReadonly ? readonlyMap : reactiveMap;\r\n  const existProxy = proxyMap.get(target);\r\n  if (existProxy) {\r\n    return existProxy;\r\n  }\r\n  const newProxy = new Proxy(target, baseHandler)\r\n  proxyMap.set(target, newProxy);\r\n  return newProxy;\r\n}"],"names":[],"mappings":"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"}